# Engine to generate protected event Settlements for Bidding

## Usage

### 1. Gathering input data

```bash
# Download input files from Google Storage
epoch=652
bucket=marinade-validator-bonds-mainnet
# generated by @marinade-finance/validator-bonds > snapshot-parser-cli
gcloud storage cp "gs://$bucket/$epoch/validators.json" "validators.json"
gcloud storage cp "gs://$bucket/$epoch/past-validators.json" "past-validators.json"
gcloud storage cp "gs://$bucket/$epoch/stakes.json" "stakes.json"
# generated by @marinade-finance/ds-sam > analyze-revenues
gcloud storage cp "gs://$bucket/$epoch/evaluation.json" "evaluation.json"
```

### 2. Generating Bidding Settlements

```bash
# Build & run
cargo run --release --bin bid-psr-distribution-cli -- \
    --settlement-config settlement-config.yaml \
    --validator-meta-collection "./validators.json" \
    --stake-meta-collection "./stakes.json" \
    --revenue-expectation-collection "./evaluation.json" \
    --output-protected-event-collection "./bid-distribution.json" \
    --output-settlement-collection "./bid-distribution-settlements.json" \
    --output-merkle-tree-collection "./bid-distribution-merkle-trees.json"
```
