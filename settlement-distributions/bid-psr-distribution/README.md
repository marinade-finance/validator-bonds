# Engine to generate Settlements for Bidding

## Usage

### 1. Gathering input data

```bash
# Download input files from Google Storage
epoch=727
bucket=marinade-validator-bonds-mainnet
# generated by @marinade-finance/validator-bonds > snapshot-parser-cli
gcloud storage cp "gs://$bucket/$epoch/validators.json" "validators.json"
gcloud storage cp "gs://$bucket/$epoch/stakes.json" "stakes.json"
# generated by @marinade-finance/ds-sam > analyze-revenues
gcloud storage cp "gs://$bucket/$epoch/evaluation.json" "evaluation.json"
```

### 2. Generating protected events (PSR) for Bidding

```bash
# Setup whitelisting (check .buildkite/prepare-claims.yml)
# native stake authority, liquid stake authority, and the exit native staker authority
export WHITELIST_STAKE_AUTHORITY="stWirqFCf2Uts1JBL1Jsd3r6VBWhgnpdPxCTe1MFjrq,4bZ6o3eUUNXhKuqjdCnCoPAoLgWiuLYixKaxoa8PpiKk,ex9CfkBZZd6Nv9XdnoDmmB45ymbu4arXVk7g5pWnt3N"

# Build & run
cargo run --release --bin bid-psr-distribution-cli -- \
    --settlement-config settlement-config.yaml \
    --validator-meta-collection "./validators.json" \
    --stake-meta-collection "./stakes.json" \
    --revenue-expectation-collection "./evaluation.json" \
    --output-protected-event-collection "./bid-psr-distribution.json" \
    --output-settlement-collection "./bid-psr-distribution-settlements.json" \
    --output-merkle-tree-collection "./bid-psr-distribution-merkle-trees.json"
```
